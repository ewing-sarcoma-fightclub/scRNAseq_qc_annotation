Ewing Sarcoma scRNA-seq Pipeline - Install Guide

1) Clone repository
   git clone https://github.com/ewing-sarcoma-fightclub/scRNAseq_qc_annotation.git
   cd scRNAseq_qc_annotation

2) Recommended setup (one command)
   ./bin/setup_envs.sh

   This command:
   - creates/updates Python + R environments
   - installs required R packages in dependency-safe order
   - writes env/config.local.env with resolved R_BIN/PYTHON_BIN
   - sets R_LIBS_USER=NULL in config.local to avoid user-library package conflicts

3) R package install order (implemented in r/install_pipeline_packages.R)
   a) CRAN baseline: future, mclust, remotes, statmod
   b) Bioconductor: AUCell, DropletUtils
   c) CRAN stack for DropletQC compatibility: nloptr, lme4, pbkrtest, car, rstatix, ggpubr
   d) GitHub-only required packages:
      - chris-mcginnis-ucsf/DoubletFinder
      - powellgenomicslab/DropletQC
   e) Optional Azimuth references (SeuratData::InstallData)

4) Manual env creation (if skipping setup_envs.sh)
   Linux:
     micromamba create -n ewing-scrna-py -f env/envs/python.lock.yml
     micromamba create -n ewing-scrna-r  -f env/envs/r.lock.yml
     micromamba run -n ewing-scrna-r env -u R_LIBS R_LIBS_USER=NULL Rscript r/install_pipeline_packages.R

   macOS (Apple Silicon):
     micromamba create -n ewing-scrna-py -f env/envs/python.yml
     micromamba create -n ewing-scrna-r  -f env/envs/r.macos.yml
     micromamba run -n ewing-scrna-r env -u R_LIBS R_LIBS_USER=NULL Rscript r/install_pipeline_packages.R

   macOS (Intel):
     micromamba create -n ewing-scrna-py -f env/envs/python.yml
     micromamba create -n ewing-scrna-r  -f env/envs/r.yml
     micromamba run -n ewing-scrna-r env -u R_LIBS R_LIBS_USER=NULL Rscript r/install_pipeline_packages.R

5) Local config
   (setup_envs.sh already creates env/config.local.env)
   [ -f env/config.local.env ] || cp env/config.env env/config.local.env
   Edit env/config.local.env:
   - FASTQ_ROOT (if using FASTQs)
   - AMBIQUANT_REPO (optional)
   - If no BAM files: SEURAT_FINAL_REQUIRE_DROPLETQC=false

6) Run pipeline
   Full run:
     ./bin/run_all.sh

   Matrix-only run (no FASTQs/BAMs):
     ./bin/prepare_geo_primary.sh --clean
     ./bin/run_all.sh --skip-cellranger --cellranger-root ./outputs/cellranger --qc-out ./outputs/qc --config ./env/config.local.env

Optional: pre-install Azimuth references (large download)
   ./bin/setup_envs.sh --install-azimuth-refs --azimuth-refs lungref,liverref

Notes:
- Cell Ranger is proprietary and must be installed separately.
- Outputs are written under ./outputs/.
