# Pipeline configuration (edit paths before running)

# Required input
FASTQ_ROOT="/path/to/fastqs"

# AmbiQuant
AMBIQUANT_REPO=""
# Optional: if set, AmbiQuant runs inside this micromamba/conda env
AMBIQUANT_ENV=""
MICROMAMBA_BIN="micromamba"

# Tools
CELLRANGER_BIN="cellranger"
PYTHON_BIN="python3"
R_BIN="Rscript"
# Keep runtime package resolution inside the configured R environment
R_LIBS_USER="NULL"

# Outputs (default to writable locations under this pipeline directory)
CELLRANGER_REF_ROOT="${PIPELINE_ROOT}/outputs/refdata"
CELLRANGER_OUT_ROOT="${PIPELINE_ROOT}/outputs/cellranger"
QC_OUT_ROOT="${PIPELINE_ROOT}/outputs/qc"
# Optional: SHA256 for the 10x reference tarball
REF_TGZ_SHA256=""

# Resources
CELLRANGER_CORES=10
CELLRANGER_MEM_GB=80
# Set true for snRNA-seq, false for scRNA-seq
CELLRANGER_INCLUDE_INTRONS=true

# DoubletFinder
DOUBLETFINDER_RATE=auto
DOUBLETFINDER_CHEMISTRY=""
DOUBLETFINDER_NPCS=30
DOUBLETFINDER_MIN_FEATURES=200
DOUBLETFINDER_MIN_CELLS=3
# Leave empty to skip MT filtering
DOUBLETFINDER_MAX_PERCENT_MT=
DOUBLETFINDER_SEED=1
# Doublet filtering mode in Seurat final subsetting: doubletfinder|scrublet|union|intersection
DOUBLET_FILTER_MODE=union

# CellMarker module pruning
CELL_MARKER_KEEP_BY_GROUPING=true
CELL_MARKER_MAX_JACCARD=0.7
CELL_MARKER_DROP_MODULES=

# Ensembl -> symbol mapping duplicate tolerance (-1 = allow any; >=0 to enforce)
ENSEMBL_SYMBOL_DUP_MAX=-1

# AUCell scoring (requires non-negative assay slot)
AUCELL_SLOT=counts
AUCELL_MIN_GENES=10
AUCELL_MAX_RANK=0
AUCELL_NCORES=1

# Seurat clustering for SoupX (no filtering)
SEURAT_NPCS=30
SEURAT_RESOLUTION=0.5
SEURAT_NFEATURES=2000
SEURAT_SEED=1

# Final Seurat subsetting + normalization/clustering
SEURAT_FINAL_OUT="${PIPELINE_ROOT}/outputs/qc/seurat_qc"
SEURAT_FINAL_USE_SOUPX=true
SEURAT_FINAL_REQUIRE_EMPTYDROPS=true
SEURAT_FINAL_REQUIRE_DROPLETQC=true
SEURAT_FINAL_NPCS=30
SEURAT_FINAL_RESOLUTION=0.5
SEURAT_FINAL_SEED=1
SEURAT_FINAL_MIN_CELLS=3
SEURAT_FINAL_MIN_FEATURES=200
SEURAT_FINAL_REGRESS=false
SEURAT_FINAL_REGRESS_CELL_CYCLE=false
SEURAT_FINAL_MAX_PERCENT_MT=
SEURAT_FINAL_MAX_PERCENT_RIBO=
SEURAT_FINAL_BASIC_MIN_FEATURES=

# CellMarker2.0 annotation
CELL_MARKER_XLSX="${PIPELINE_ROOT}/resources/Cell_marker_Seq_human.xlsx"
CELL_MARKER_TISSUES="blood,bone,embryonic brain,dorsal root ganglion,embryonic stem cell,epithelium,lung,bone marrow,cartilage,skeletal muscle,adipose tissue,blood vessel,skin,embryo"
CELL_MARKER_MIN_GENES=5
CELL_MARKER_CTRL=20
CELL_MARKER_SEED=1
CELL_MARKER_MIN_ACTIVE_CELLS=5
CELL_MARKER_MIN_ACTIVE_FRAC=0.001
ANNOTATION_DOUBLET_FILTER=true
ANNOTATION_DOUBLET_MODE=union
ANNOTATION_DOUBLET_REQUIRE=false
RARE_IMMUNE_ENABLE=true
RARE_IMMUNE_MAX_CELLS=50
RARE_IMMUNE_MAX_FRAC=0.02
RARE_IMMUNE_MIN_AZ_CELLS=3
RARE_IMMUNE_MIN_AZ_FRAC=0.02
ANNOTATION_TRIAGE_ENABLE=true
ANNOTATION_TRIAGE_APPLY=true
ANNOTATION_TRIAGE_PADJ=1e-4
ANNOTATION_TRIAGE_MIN_OVERLAP=5
ANNOTATION_TRIAGE_UNKNOWN_PADJ=1e-2
ANNOTATION_TRIAGE_UNKNOWN_MIN_OVERLAP=2
ANNOTATION_TRIAGE_USE_LINEAGE=true
SEURAT_ANNOTATE_OUT="${PIPELINE_ROOT}/outputs/annotation_integration/seurat_annotation_integration"
SEURAT_DO_INTEGRATION=true
SEURAT_INTEGRATION_NPCS=30
SEURAT_INTEGRATION_RESOLUTION=0.5
# Integration tuning (optional)
# Lower k.weight if you see: "Number of anchor cells is less than k.weight"
SEURAT_INTEGRATION_KWEIGHT=80
# Increase k.anchor if anchors are too sparse (rare)
SEURAT_INTEGRATION_KANCHOR=5
EWING_SIGNATURE_CSV="${PIPELINE_ROOT}/resources/Aynaud.csv"
CELLTYPE_GROUPING_FILE="${PIPELINE_ROOT}/resources/celltype_grouping.txt"
CELLTYPE_GROUPING_PERCENTILE=0.99
# Azimuth threshold calibration (per reference)
AZIMUTH_THRESHOLD_METHOD=mixture
AZIMUTH_THRESHOLD_POSTERIOR=0.95
AZIMUTH_THRESHOLD_MIN_N=200
AZIMUTH_THRESHOLD_FALLBACK_PCT=0.99
CELLTYPE_GROUPING_MIN_MOD_FRAC=0.40
CELLTYPE_GROUPING_MIN_MOD_CELLS=10
CELLTYPE_GROUPING_AZ_LINEAGE_MIN=0.60
CELLTYPE_GROUPING_AZ_LINEAGE_DELTA=0.07
# Orthogonal validation (cluster marker DE)
ANNOTATION_DE_ASSAY=RNA
ANNOTATION_DE_MIN_PCT=0.25
ANNOTATION_DE_LOGFC=0.25
ANNOTATION_DE_MAX_CELLS_PER_CLUSTER=2000
ANNOTATION_DE_MAX_TOTAL_CELLS=50000
ANNOTATION_DE_TOP_N=50
ANNOTATION_DE_SEED=1
